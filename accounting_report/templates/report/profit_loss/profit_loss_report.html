{% extends 'dashboard/index.html' %}
{% load mathfilters %}
{% load custom_tags %}
{% load humanize %}
{% block dashoard_title %} 
Profit Loss Report - 
{% endblock %}


{% block dashboard_heading %}
<h1 class="h5 mb-0 text-gray-800">
   Profit Loss Report
</h1>
<style>
    table td, th{
        padding: 0px!important;
    }
</style>


{% endblock %}


{% block dashboard_content %}

<div class="">

    
<p>
    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
      Export PDF
    </a>
   
  </p>
  <div class="collapse" id="collapseExample">
    <div class="card card-body" style="padding: 10px!important;">
      
  <form method="post" action="{% url 'acr:balance_sheet_pdf' module=module %}" target="_blank">
    {% csrf_token %}
    <div class="row">
        <div class="col-md-2 col-sm-12 mb-2">
            <label for="company2">Choose Company</label>
            <select name="company2" required class="form-control" id="company2">
                {% for item in global_companies %}
                {% if company == item.id %}
                <option value="{{item.id}}" selected>{{item}}</option>
                {% else %}
                <option value="{{item.id}}" >{{item}}</option>
                {% endif %}
                {% endfor %}
            </select>
        </div>
     
        <div class="col-md-2 col-sm-12 mb-2">
            <label for="from_date2">From Date</label>
            <input type="date" required name="from_date2" id="from_date2" class="form-control" value="{{from_date|date:'Y-m-d'}}" >
        </div>
        <div class="col-md-2 col-sm-12 mb-2">
            <label for="to_date2">To Date</label>
            <input type="date" required name="to_date2" id="to_date2" class="form-control" value="{{to_date|date:'Y-m-d'}}" >
        </div>
        <div class="col-md-1 col-sm-12">

            <button class="btn mt-4 btn-primary" type="submit">PDF</button>
        </div>
    </div>
  </form>

  
    </div>
  </div>
    
    <form method="post" class="mb-3">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-2 col-sm-12 mb-2">
                <label for="company">Choose Company</label>
                <select name="company" required class="form-control" id="company">
                    <option value="" selected disabled hidden>Choose Company</option>
                    {% for item in global_companies %}
                    {% if company == item.id %}
                    <option value="{{item.id}}" selected>{{item}}</option>
                    {% else %}
                    <option value="{{item.id}}" >{{item}}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
           
            <div class="col-md-2 col-sm-12 mb-2">
                <label for="from_date">From Date</label>
                <input type="date" required name="from_date" id="from_date" class="form-control" value="{{from_date|date:'Y-m-d'}}" >
            </div>
            <div class="col-md-2 col-sm-12 mb-2">
                <label for="to_date">To Date</label>
                <input type="date" required name="to_date" id="to_date" class="form-control" value="{{to_date|date:'Y-m-d'}}" >
            </div>

            <div class="col-md-2 col-sm-12 mb-2">
                <label for="expanded">Expanded</label>
                <select name="expanded" id="expanded" class="form-control form-control-sm">
                    {% if expanded == 1 %}
                    <option value="1" selected>Yes</option>
                    <option value="0">No</option>
                    {% else %}
                    <option value="1">Yes</option>
                    <option value="0" selected>No</option>
                    {% endif %}
                </select>
            </div>

            <div class="col-md-1 col-sm-12">

                <button class="btn mt-4 btn-primary" type="submit">Search</button>
            </div>
        </div>
    </form>


    {% if direct_sales_report_list or direct_purchase_report_list or indirect_purchase_report_list  or indirect_sales_report_list %}
    <div class="row ">
        <div class="col-md-6 col-sm-12 ">
            <table class="table table-primary table-hover  table-md-responsive" id="bs_table">
                <thead class="table-dark">
                    <tr>
                        <th colspan="2" align="center">Particulars</th>
                        <th align="center">Amount</th>
                    </tr>
                </thead>
                <tbody>
                   
                    {% for data in direct_purchase_report_list %}
                    {% include 'report/profit_loss/list.html' %}
                    {% if expanded == 1 %}
                    {% for ledger in data.ledger_report %}
                    <tr>
                        <td style="font-size: 11px; font-weight: 400;">
                            <span style="margin-left: {{data.depth|add:23}}px;"></span>
                            {% if ledger.id and ledger.type %}
                            <a target="_blank" href="{% url 'acr:ledger_category_transactions' module=module company=company from_date=from_date to_date=to_date id=data.category.id detail_id=ledger.id detail=1 type=ledger.type %}">  
                                  <i> {{ledger.particulars}} </i>
                                </a>
                                {% else %}
                                 <i> {{ledger.particulars}} </i>
                                {% endif %}
                           
                        </td>
                        <td data-order="0" style="font-size: 11px; font-weight: 400; text-align: right;">
                            {% if ledger.debit|sub:ledger.credit >= 0 %} 
                            {{ledger.debit|sub:ledger.credit|floatformat:2}} Dr.   
                            {% else %}
                            {{ledger.debit|sub:ledger.credit|mul:-1|floatformat:2}} Cr.   
                            {% endif %}
                        </td>
                        <td data-order="0">&nbsp;</td>
        
                    </tr>
                    {% endfor %}
                    {% endif %}
                {% endfor %}          
                </tbody>
            </table>
        </div>
        <div class="col-md-6 col-sm-12">
            <table class="table table-primary table-hover table-md-responsive" id="bs_table">
                <thead class="table-dark">
                    <tr>
                        <th colspan="2" align="center">Particulars</th>
                        <th align="center">Amount</th>         
                    </tr>
                </thead>
                <tbody>
                {% for data in direct_sales_report_list %}
                    {% include 'report/profit_loss/list.html' %}
                    {% if expanded == 1 %}
                    {% for ledger in data.ledger_report %}
                    <tr>
                        <td style="font-size: 11px; font-weight: 400;">
                            <span style="margin-left: {{data.depth|add:23}}px;"></span>
                            {% if ledger.id and ledger.type %}
                            <a target="_blank" href="{% url 'acr:ledger_category_transactions' module=module company=company from_date=from_date to_date=to_date id=data.category.id detail_id=ledger.id detail=1 type=ledger.type %}">  
                                  <i> {{ledger.particulars}} </i>
                                </a>
                                {% else %}
                                 <i> {{ledger.particulars}} </i>
                                {% endif %}
                           
                        </td>
                        <td data-order="0" style="font-size: 11px; font-weight: 400; text-align: right;">
                            {% if ledger.debit|sub:ledger.credit >= 0 %} 
                            {{ledger.debit|sub:ledger.credit|floatformat:2}} Dr.   
                            {% else %}
                            {{ledger.debit|sub:ledger.credit|mul:-1|floatformat:2}} Cr.   
                            {% endif %}
                        </td>
                        <td data-order="0">&nbsp;</td>
        
                    </tr>
                    {% endfor %}
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>

       
        <div class="col-md-6 col-sm-12">
            <table class="table   table-md-responsive" id="bs_table">
                {% if gross > 0 %}
                    <tr>
                        <th colspan="2"><i>Gross Profit</i></th>
                        <th align="right" class="text-right"> <strong> {{gross|floatformat:2}}</strong></th>         
                    </tr>

                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_direct_sales|floatformat:2}}</strong></th>         
                    </tr>
                {% else %}
                    <tr>
                        <th colspan="2" align="center">&nbsp;</th>
                        <th align="right" class="text-right"> <strong>&nbsp;</strong></th>         
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_direct_purchase|floatformat:2}}</strong></th>         
                    </tr>
                {% endif %}
                    
            </table>
        </div>
        <div class="col-md-6 col-sm-12">
            <table class="table table-primary  table-md-responsive" id="bs_table">
                {% if gross < 0 %}
                    <tr>
                        <th colspan="2"><i>Gross Loss</i></th>
                        <th align="right" class="text-right"> <strong> {{gross|mul:-1|floatformat:2}}</strong></th>         
                    </tr>

                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_direct_purchase|floatformat:2}}</strong></th>         
                    </tr>
                    {% else %}
                    <tr>
                        <th colspan="2" align="center">&nbsp;</th>
                        <th align="right" class="text-right"> <strong>&nbsp;</strong></th>         
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_direct_sales|floatformat:2}}</strong></th>         
                    </tr>
                {% endif %}
               
            </table>
        </div>
       
        <div class="col-md-6 col-sm-12 ">
            <table class="table table-primary table-hover  table-md-responsive" id="bs_table">
               
                <tbody>
                    {% if gross < 0 %}
                    <tr>
                        <th colspan="2">To Gross Loss</th>
                        <th align="right" class="text-right"> <strong> {{gross|mul:-1|floatformat:2}}</strong></th>         
                    </tr>
                    {% endif %}
                {% for data in indirect_purchase_report_list %}
                    {% include 'report/profit_loss/list.html' %}

                    {% for ledger in data.ledger_report %}
                    <tr>
                        <td style="font-size: 11px; font-weight: 400;">
                            <span style="margin-left: {{data.depth|add:23}}px;"></span>
                            {% if ledger.id and ledger.type %}
                            <a target="_blank" href="{% url 'acr:ledger_category_transactions' module=module company=company from_date=from_date to_date=to_date id=data.category.id detail_id=ledger.id detail=1 type=ledger.type %}">  
                                  <i> {{ledger.particulars}} </i>
                                </a>
                                {% else %}
                                 <i> {{ledger.particulars}} </i>
                                {% endif %}
                           
                        </td>
                        <td data-order="0" style="font-size: 11px; font-weight: 400; text-align: right;">
                            {% if ledger.debit|sub:ledger.credit >= 0 %} 
                            {{ledger.debit|sub:ledger.credit|floatformat:2}} Dr.   
                            {% else %}
                            {{ledger.debit|sub:ledger.credit|mul:-1|floatformat:2}} Cr.   
                            {% endif %}
                        </td>
                        <td data-order="0">&nbsp;</td>
        
                    </tr>
                    {% endfor %}
                {% endfor %}          
                </tbody>
            </table>
        </div>
        <div class="col-md-6 col-sm-12">
            <table class="table table-primary table-hover table-md-responsive" id="bs_table">
                
                <tbody>
                {% if gross > 0 %}
                    <tr>
                        <th colspan="2">By Gross Profit</th>
                        <th align="right" class="text-right"> <strong> {{gross|floatformat:2}}</strong></th>         
                    </tr>
                {% endif %}
                {% for data in indirect_sales_report_list %}
                    {% include 'report/profit_loss/list.html' %}

                    {% for ledger in data.ledger_report %}
                    <tr>
                        <td style="font-size: 11px; font-weight: 400;">
                            <span style="margin-left: {{data.depth|add:23}}px;"></span>
                            {% if ledger.id and ledger.type %}
                            <a target="_blank" href="{% url 'acr:ledger_category_transactions' module=module company=company from_date=from_date to_date=to_date id=data.category.id detail_id=ledger.id detail=1 type=ledger.type %}">  
                                  <i> {{ledger.particulars}} </i>
                                </a>
                                {% else %}
                                 <i> {{ledger.particulars}} </i>
                                {% endif %}
                           
                        </td>
                        <td data-order="0" style="font-size: 11px; font-weight: 400; text-align: right;">
                            {% if ledger.debit|sub:ledger.credit >= 0 %} 
                            {{ledger.debit|sub:ledger.credit|floatformat:2}} Dr.   
                            {% else %}
                            {{ledger.debit|sub:ledger.credit|mul:-1|floatformat:2}} Cr.   
                            {% endif %}
                        </td>
                        <td data-order="0">&nbsp;</td>
        
                    </tr>
                    {% endfor %}
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="col-md-6 col-sm-12">
            <table class="table   table-md-responsive" id="bs_table">
                {% if net > 0 %}
                    <tr>
                        <th colspan="2"><i>Net Profit</i></th>
                        <th align="right" class="text-right"> <strong> {{net|floatformat:2}}</strong></th>         
                    </tr>

                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_indirect_sales|add:gross|floatformat:2}}</strong></th>         
                    </tr>
                {% else %}
                    <tr>
                        <th colspan="2" align="center">&nbsp;</th>
                        <th align="right" class="text-right"> <strong>&nbsp;</strong></th>         
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_indirect_purchase|add:gross|mul:-1|floatformat:2}}</strong></th>         
                    </tr>
                {% endif %}
                    
            </table>
        </div>
        <div class="col-md-6 col-sm-12">
            <table class="table table-primary  table-md-responsive" id="bs_table">
                {% if gross < 0 %}
                    <tr>
                        <th colspan="2"><i>Net Loss</i></th>
                        <th align="right" class="text-right"> <strong> {{net|mul:-1|floatformat:2}}</strong></th>         
                    </tr>

                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_indirect_purchase|add:gross|mul:-1|floatformat:2}}</strong></th>         
                    </tr>
                    {% else %}
                    <tr>
                        <th colspan="2" align="center">&nbsp;</th>
                        <th align="right" class="text-right"> <strong>&nbsp;</strong></th>         
                    </tr>
                    <tr style="border-top: 1px solid black; border-bottom: 1px solid black;">
                        <th colspan="2">Total</th>
                        <th align="right" class="text-right"> <strong> {{total_indirect_sales|add:gross|floatformat:2}}</strong></th>         
                    </tr>
                {% endif %}
               
            </table>
        </div>
       
    </div>
    {% endif %}
    


</div>

{% endblock %}

{% block js %}
<script>
    let table = new DataTable('#hh', {
        // options
        ordering:false
    });
  </script>
{% endblock %}