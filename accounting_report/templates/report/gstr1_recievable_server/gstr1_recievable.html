{% extends 'dashboard/index.html' %}
{% load mathfilters %}
{% load custom_tags %}

{% block dashoard_title %}
GSTR1 List -
{% endblock %}

{% block dashboard_heading %}
<h1 class="h4 mb-0 text-gray-800">
  GSTR1 Recievables List
</h1>

<style>
  table td,
  th {
    font-size: 13px !important;
    padding: 1px !important;
  }
</style>

{% endblock %}


{% block dashboard_content %}

<div class="mb-4">

  <p>
    <a class="btn btn-primary" data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="false" aria-controls="collapseExample">
      Export Complete Excel
    </a>
   
  </p>
  <div class="collapse" id="collapseExample">
    <div class="card card-body" style="padding: 10px!important;">
      
  <form method="post" action="{% url 'acr:exportGSTR1DetailsExcel' %}" target="_blank">
    {% csrf_token %}
    <div class="row">
      
      <div class="col-2">
        <label class="required" for="company_gst_code2">GST Code</label>
        <select name="company_gst_code2" class="form-control" id="company_gst_code2" required>
          {% if not company_gst_code or company_gst_code == "A" %}
          <option value="A" selected>ALL</option>
          {% else %}
          <option value="A">ALL</option>
          {% endif %}
          {% for i in companies_gst_code %}
          {% if i.company_gst_code == company_gst_code and company_gst_code %}
          <option value="{{i.company_gst_code}}" selected>{{i.company_gst_code}}</option>
          {% else %}
          <option value="{{i.company_gst_code}}" >{{i.company_gst_code}}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>
     
      <div class="col-2">
        <label class="required"  for="from_date2">From</label>
        <input type="date" name="from_date2" value="{{from_date|date:'Y-m-d'}}" required id="from_date2"
          class="form-control form-control-sm" />
      </div>
      <div class="col-2">
        <label class="required"  for="to_date2">To</label>
        <input type="date" name="to_date2" required id="to_date2" value="{{to_date|date:'Y-m-d'}}"
          class="form-control form-control-sm" />
      </div>

      

      <div class="col-md-3">
        <button type="submit" class="btn btn-primary btn-sm mt-4">Export</button>
      </div>
    </div>
  </form>

  
    </div>
  </div>


  <form method="post">
    {% csrf_token %}
    <div class="row">
      <div class="col-2">
        <label for="filter_percent">Filter By %</label>
        <select name="filter_percent" id="filter_percent" class="form-control form-control-sm">
          {% if filter_percent == "All" %}
          <option value="All" selected>All</option>
          {% else %}
          <option value="All">All</option>
          {% endif %}

          {% if filter_percent == "5" %}
          <option value="5" selected>5%</option>
          {% else %}
          <option value="5">5%</option>
          {% endif %}

          {% if filter_percent == "12" %}
          <option value="12" selected>12%</option>
          {% else %}
          <option value="12">12%</option>
          {% endif %}

          {% if filter_percent == "18" %}
          <option value="18" selected>18%</option>
          {% else %}
          <option value="18">18%</option>
          {% endif %}

        </select>
      </div>
      <div class="col-2">
        <label class="required" for="company_gst_code">GST Code</label>
        <select name="company_gst_code" class="form-control" id="company_gst_code" required>
          {% if not company_gst_code or company_gst_code == "A" %}
          <option value="A" selected>ALL</option>
          {% else %}
          <option value="A">ALL</option>
          {% endif %}
          {% for i in companies_gst_code %}
          {% if i.company_gst_code == company_gst_code and company_gst_code %}
          <option value="{{i.company_gst_code}}" selected>{{i.company_gst_code}}</option>
          {% else %}
          <option value="{{i.company_gst_code}}" >{{i.company_gst_code}}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <label class="required" for="rcm_include">Type</label>
        <select name="rcm_include" class="form-control" id="rcm_include" required>
          {% if rcm_include == "N" %}
          <option value="N" selected>Non-RCM</option>
          {% else %}
          <option value="N">Non-RCM</option>
          {% endif %}
          {% if rcm_include == "R" %}
          <option value="R" selected>RCM</option>
          {% else %}
          <option value="R">RCM</option>
          {% endif %}
          {% if rcm_include == "A" %}
          <option value="A" selected>ALL</option>
          {% else %}
          <option value="A">ALL</option>
          {% endif %}
        
        </select>
      </div>
      <div class="col-2">
        <label class="required"  for="from_date">From</label>
        <input type="date" name="from_date" value="{{from_date|date:'Y-m-d'}}" required id="from_date"
          class="form-control form-control-sm" />
      </div>
      <div class="col-2">
        <label class="required"  for="to_date">To</label>
        <input type="date" name="to_date" required id="to_date" value="{{to_date|date:'Y-m-d'}}"
          class="form-control form-control-sm" />
      </div>

      

      <div class="col-md-2">
        <button type="submit" class="btn btn-primary btn-sm mt-4">Filter</button>
      </div>
    </div>
  </form>

  


</div>

{% if report %}

<div class="large-table-fake-top-scroll-container-3">
  <div>&nbsp;</div>
</div>


<div class="table-responsive">


  <table class="table table-primary table-bordered compact display" id="gstr1_table">
    <thead>
      <tr>
        <th style="min-width:50px!important" scope="col">Branch</th>
        <th style="min-width:30px!important" scope="col">Status</th>
        <th style="min-width:150px!important" scope="col">Bill No.</th>
        <th style="min-width:150px!important" scope="col">Date</th>
        <th style="min-width:50px!important" scope="col">Type</th>
        <th style="min-width:50px!important" scope="col">Category</th>
        <th style="min-width:100px!important" scope="col">Job No</th>
        <th style="min-width:100px!important" scope="col">Job Type</th>
        <th style="min-width:150px!important" scope="col">Location</th>
        <th style="min-width:150px!important" scope="col">GST No.</th>
        <th style="min-width:150px!important" scope="col">State</th>
        <th style="min-width:150px!important" scope="col">Party Name</th>
        <th style="min-width:50px!important" scope="col">Currency</th>
        <th style="min-width:100px!important" scope="col">Total Amount</th>
        {% if filter_percent == "All" %}
        <th scope="col">Non Tax Amount</th>
        {% endif %}

        {% if filter_percent == "5" or filter_percent == "All" %}
        <th scope="col">Taxable 5%</th>
        <th scope="col">CGST 2.5%</th>
        <th scope="col">SGST 2.5%</th>
        <th scope="col">IGST 5%</th>
        {% endif %}

        {% if filter_percent == "12" or filter_percent == "All" %}
        <th scope="col">Taxable 12%</th>
        <th scope="col">CGST 6%</th>
        <th scope="col">SGST 6%</th>
        <th scope="col">IGST 12%</th>
        {% endif %}

        {% if filter_percent == "18" or filter_percent == "All" %}
        <th scope="col">Taxable 18%</th>
        <th scope="col">CGST 9%</th>
        <th scope="col">SGST 9%</th>
        <th scope="col">IGST 18%</th>
        {% endif %}

        <th scope="col">Total GST</th>


      </tr>
    </thead>
    <tbody>
  
      {% for data in report %}

      {% if filter_percent == "All" %}
      {% include 'report/gstr1_recievable_server/gstr1_list.html' %}
      {% endif %}

      {% if filter_percent == "5"  %}
      {% include 'report/gstr1_recievable_server/gstr1_list.html' %}
      {% endif %}


      {% if filter_percent == "12" %}
      {% include 'report/gstr1_recievable_server/gstr1_list.html' %}
      {% endif %}



      {% if filter_percent == "18"  %}
      {% include 'report/gstr1_recievable_server/gstr1_list.html' %}
      {% endif %}

      {% endfor %}

      {% for data in crn_report %}

      {% if filter_percent == "All" %}
      {% include 'report/gstr1_recievable_server/crn_gstr_list.html' %}
      {% endif %}
      {% if filter_percent == "5"  %}
      {% include 'report/gstr1_recievable_server/crn_gstr_list.html' %}
      {% endif %}
      {% if filter_percent == "12" %}
      {% include 'report/gstr1_recievable_server/crn_gstr_list.html' %}
      {% endif %}
      {% if filter_percent == "18"  %}
      {% include 'report/gstr1_recievable_server/crn_gstr_list.html' %}
      {% endif %}

      {% endfor %}

    </tbody>

    <tfoot>
      <tr>
        <td class="text-white text-right" colspan="12"></td>
        <td class="text-white text-right" >Total</td>


        <td class="text-white text-right"></td>
        {% if filter_percent == "All" %}
        <td class="text-white text-right"></td>

        {% endif %}

        {% if filter_percent == "5" or filter_percent == "All" %}
        <td class="text-white text-right"></td>
        <td class="text-white text-right"></td>
        <td class="text-white text-right"></td>
        <td class="text-white text-right"></td>
        {% endif %}

        {% if filter_percent == "12" or filter_percent == "All" %}
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        {% endif %}

        {% if filter_percent == "18" or filter_percent == "All" %}
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        <td class="text-right text-white"></td>
        {% endif %}

        <td style="color: white!important;" align="right"></td>



      </tr>
    </tfoot>
  </table>
</div>
{% endif %}


{% if error_report %}
<h6  class="text-danger">Please Check Below Invoices Party Address Details. This Invoices Not Include In Above GSTR1 Report. </h6>
<table class="table compact display">
  <thead>
    <tr>
      <th>Invoice No.</th>
    </tr>
  </thead>
  <tbody>
    {% for data in error_report %}
    <tr>
      <td>
        {{data.final_invoice_no}}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

{% if error_crn_report %}
<h6  class="text-danger">Please Check Below Credit Note Party Address Details. This Credit Notes Not Include In Above GSTR1 Report. </h6>
<table class="table compact display">
  <thead>
    <tr>
      <th>Credit Note No.</th>
    </tr>
  </thead>
  <tbody>
    {% for data in error_crn_report %}
    <tr>
      <td>
        {{data.final_invoice_no}}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}

{% block js %}


<script src="https://cdn.datatables.net/plug-ins/1.13.4/api/sum().js"></script>
<script>
  $(document).ready(function () {

    
    

    jQuery.fn.dataTable.Api.register('sum()', function () {
      return this.flatten().reduce(function (a, b) {
        var x = parseFloat(a);
        var y = parseFloat($(b).attr('data-order'));

        return parseFloat(x + y).toFixed(2)
      }, 0);
    });


    let table = new DataTable('#gstr1_table', {
      dom: "BQlfrtip",
      buttons: [
    {
        extend: 'collection',
        text: 'Export',
        buttons: [
            'copy',
            { extend: 'excel', footer: true,header:true},
            { extend: 'csv', footer: true,header:true},
            { extend: 'pdf', footer: true,header:true},
        
        ]
    }
    ],

     
     
    
      lengthMenu: [
      [10, 25, 50, -1],
      [10, 25, 50, 'All'],
    ],
      drawCallback: function () {
        var api = this.api();

        var from_row = 13
        var to_row = 27

        for (var i = from_row; i <= to_row; i++) {
          $(api.table().column(i).footer()).html(
            api.column(i, { page: 'current' }).nodes().sum()
          );
        }


      }

    });
  })

  
  $(function() {
  var tableContainer = $(".table-responsive");
  var table = $(".table-responsive table");
  var fakeContainer = $(".large-table-fake-top-scroll-container-3");
  var fakeDiv = $(".large-table-fake-top-scroll-container-3 div");

  var tableWidth = table.width();
  fakeDiv.width(tableWidth);

  fakeContainer.scroll(function() {
tableContainer.scrollLeft(fakeContainer.scrollLeft());
  });
})



</script>

{% endblock %}