<div class="row" id="driver-row">
    {% if update and obj.trailor_driver_ref.all|length > 0 %}
    {% for i in obj.trailor_driver_ref.all %}
    <div class="col-12 mb-2" id="driver-row-{{forloop.counter}}">
        <div class="row" >
            <div class="col-md-2">
                <input type="hidden" name="is_driver_active_{{forloop.counter}}"  id="is_driver_active_{{forloop.counter}}" value="yes" />
                <label for="driver_{{forloop.counter}}">Driver</label>
                <select name="driver_{{forloop.counter}}" id="driver_{{forloop.counter}}" class="form-control">
                    <option value="" selected hidden disabled>--------</option>
                    {% for driver in drivers %}
                    {% if driver.id == i.driver.id %}
                    <option value="{{driver.id}}" selected>{{driver.driver_name}}</option>
                    {% else %}
                    <option value="{{driver.id}}">{{driver.driver_name}}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label for="from_date_{{forloop.counter}}">From Date</label>
                <input type="date" value="{{ i.from_date|date:'Y-m-d' }}" name="from_date_{{forloop.counter}}" id="from_date_{{forloop.counter}}" class="form-control">
            </div>
            <div class="col-md-2">
                <label for="to_date_1">To Date</label>
                <input type="date" value="{{ i.to_date|date:'Y-m-d' }}" name="to_date_{{forloop.counter}}" id="to_date_{{forloop.counter}}" class="form-control">
            </div>
            <div class="col-md-4">
                <label for="remarks_1">Remarks</label>
                <input type="text" value="{{i.remarks}}" name="remarks_{{forloop.counter}}" id="remarks_{{forloop.counter}}" class="form-control">
            </div>
            <div class="col-md-2">
                
                <button type="button" onclick="deleteDriverRow({{forloop.counter}})" class="btn btn-danger mt-4">Delete</button>
            </div>
        </div>
    
        </div>
    {% endfor %}
    {% else %}
    <div class="col-12 mb-2" id="driver-row-1">

        <div class="row" >
            <div class="col-md-2">
                <input type="hidden" name="is_driver_active_1" id="is_driver_active_1" value="yes" />
                <label for="driver_1">Driver</label>
                <select name="driver_1" id="driver_1" class="form-control">
                    <option value="" selected hidden disabled>--------</option>
                    {% for driver in drivers %}
                    <option value="{{driver.id}}">{{driver.driver_name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label for="from_date_1">From Date</label>
                <input type="date" name="from_date_1" id="from_date_1" class="form-control">
            </div>
            <div class="col-md-2">
                <label for="to_date_1">To Date</label>
                <input type="date" name="to_date_1" id="to_date_1" class="form-control">
            </div>
            <div class="col-md-4">
                <label for="remarks_1">Remarks</label>
                <input type="text" name="remarks_1" id="remarks_1" class="form-control">
            </div>
            <div class="col-md-2">
                
                <button type="button" onclick="deleteDriverRow(1)" class="btn btn-danger mt-4">Delete</button>
            </div>
        </div>
    
        </div>
    {% endif %}
    
</div>

<button class="btn btn-primary mb-3" type="button" onclick="addDriverRow()">Add More</button>

<script>
    var currentRowNumber = parseInt(document.getElementById('driver_total_rows').value) || 1
    const addDriverRow = () => {
        var newElement = document.createElement('div')
        currentRowNumber += 1
        newElement.classList.add('col-12')
        newElement.setAttribute('id', `driver-row-${currentRowNumber}`)
        newElement.classList.add('mb-2')
        newElement.innerHTML = `
        <div class="row">
            <div class="col-md-2">
                <input type="hidden" name="is_driver_active_${currentRowNumber}" id="is_driver_active_${currentRowNumber}" value="yes" />
                <label for="driver_${currentRowNumber}">Driver</label>
                <select name="driver_${currentRowNumber}" id="driver_${currentRowNumber}" class="form-control">
                    <option value="" selected hidden disabled>--------</option>
                    {% for driver in drivers %}
                    <option value="{{driver.id}}">{{driver.driver_name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <label for="from_date_${currentRowNumber}">From Date</label>
                <input type="date" name="from_date_${currentRowNumber}" id="from_date_${currentRowNumber}" class="form-control">
            </div>
            <div class="col-md-2">
                <label for="to_date_${currentRowNumber}">To Date</label>
                <input type="date" name="to_date_${currentRowNumber}" id="to_date_${currentRowNumber}" class="form-control">
            </div>
            <div class="col-md-4">
                <label for="remarks_${currentRowNumber}">Remarks</label>
                <input type="text" name="remarks_${currentRowNumber}" id="remarks_${currentRowNumber}" class="form-control">
            </div>
            <div class="col-md-2">
                
                <button type="button" onclick="deleteDriverRow(${currentRowNumber})" class="btn btn-danger mt-4">Delete</button>
            </div>
        </div>
        `
        document.getElementById('driver-row').append(newElement)
        document.getElementById('driver_total_rows').value = currentRowNumber
    }

    const deleteDriverRow = (index) => {
        console.log(index)
        document.getElementById(`driver-row-${index}`).style.display = "none";
        document.getElementById(`is_driver_active_${index}`).value = "no";
    }
</script>